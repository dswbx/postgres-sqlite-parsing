{
  "$schema": "https://example.com/postgres-json-schema.json",
  "type": "object",
  "properties": {
    "users": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "$primaryKey": true,
          "$default": "uuid_generate_v4()"
        },
        "username": {
          "type": "string",
          "maxLength": 50,
          "$index": "unique"
        },
        "email": {
          "type": "string",
          "maxLength": 255,
          "$index": "unique",
          "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
        },
        "age": {
          "type": "integer",
          "minimum": 18,
          "maximum": 120
        },
        "account_status": {
          "type": "string",
          "enum": [
            "active",
            "suspended",
            "deleted"
          ],
          "default": "active"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "$default": "CURRENT_TIMESTAMP"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "$default": "now()"
        },
        "metadata": {
          "type": "object"
        }
      },
      "required": [
        "username",
        "email"
      ]
    },
    "products": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "integer",
          "$primaryKey": true
        },
        "name": {
          "type": "string",
          "maxLength": 200
        },
        "description": {
          "type": "string"
        },
        "price": {
          "type": "number",
          "minimum": 1
        },
        "stock": {
          "type": "integer",
          "minimum": 0,
          "default": 0
        },
        "category": {
          "type": "string",
          "enum": [
            "electronics",
            "clothing",
            "books",
            "home",
            "toys"
          ]
        },
        "is_active": {
          "type": "boolean",
          "default": true
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "$default": "CURRENT_TIMESTAMP"
        }
      },
      "required": [
        "name",
        "price"
      ]
    },
    "orders": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "integer",
          "$primaryKey": true
        },
        "user_id": {
          "$ref": "#/properties/users/properties/id",
          "$onDelete": "cascade"
        },
        "order_number": {
          "type": "string",
          "maxLength": 20,
          "$index": "unique"
        },
        "status": {
          "type": "string",
          "enum": [
            "pending",
            "processing",
            "shipped",
            "delivered",
            "cancelled"
          ],
          "default": "pending"
        },
        "total_amount": {
          "type": "number",
          "minimum": 0
        },
        "shipping_address": {
          "type": "string"
        },
        "order_date": {
          "type": "string",
          "format": "date-time"
        },
        "shipped_date": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "order_number",
        "total_amount",
        "shipping_address",
        "order_date"
      ]
    },
    "order_items": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "integer",
          "$primaryKey": true
        },
        "order_id": {
          "$ref": "#/properties/orders/properties/id",
          "$onDelete": "cascade"
        },
        "product_id": {
          "$ref": "#/properties/products/properties/id",
          "$onDelete": "restrict"
        },
        "quantity": {
          "type": "integer",
          "minimum": 1
        },
        "unit_price": {
          "type": "number",
          "minimum": 0
        },
        "discount_percent": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "default": 0
        }
      },
      "required": [
        "quantity",
        "unit_price"
      ]
    },
    "reviews": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "integer",
          "$primaryKey": true
        },
        "product_id": {
          "$ref": "#/properties/products/properties/id",
          "$onDelete": "cascade"
        },
        "user_id": {
          "$ref": "#/properties/users/properties/id",
          "$onDelete": "set null"
        },
        "rating": {
          "type": "integer",
          "minimum": 1,
          "maximum": 5
        },
        "title": {
          "type": "string",
          "maxLength": 100
        },
        "comment": {
          "type": "string"
        },
        "verified_purchase": {
          "type": "boolean",
          "default": false
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "rating",
        "created_at"
      ]
    },
    "payment_methods": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "integer",
          "$primaryKey": true
        },
        "user_id": {
          "$ref": "#/properties/users/properties/id",
          "$onDelete": "cascade"
        },
        "method_type": {
          "type": "string",
          "enum": [
            "credit_card",
            "debit_card",
            "paypal",
            "bank_transfer"
          ]
        },
        "last_four": {
          "type": "string",
          "maxLength": 4
        },
        "is_default": {
          "type": "boolean",
          "default": false
        },
        "expires_at": {
          "type": "string",
          "format": "date"
        }
      },
      "required": []
    }
  }
}